# 责任链模式入门指南

> 目标：一步步学会责任链模式，并结合 `chain/ChainExample.java` 的示例理解如何在 Android/Java 中编写。

## 1. 责任链模式要解决什么问题？
- 需要多个处理者依次尝试处理同一个请求，比如日志过滤、权限校验、表单验证。
- 让处理节点之间“松耦合”：每个节点只处理自己关心的部分，处理不了就交给下一个。
- 方便扩展：新增/移除节点只需改装链条，不必改动已有逻辑。

## 2. 开始前的准备
1. 想清楚“请求”长什么样（可以是 Java Bean、Map、POJO）。
2. 列出每个处理者的职责，比如“检查登录状态”“检查网络”“执行真正业务”。
3. 确认节点之间遵守同一个接口：`handle(request)`，无法处理时把请求传给下一个。

## 3. 实现步骤（以 `chain/ChainExample.java` 为例）
> 按步骤抄一遍就能熟悉套路。

### 步骤 3.1：定义请求数据
```java
class UserRequest {
    private final String userName;
    private final String password;
    private final boolean hasNetwork;
    // 构造函数 + getter 见示例文件
}
```
- 一份请求只出现一份信息，避免在节点间重复传参。

### 步骤 3.2：创建 Handler 抽象基类
```java
abstract class Handler {
    private Handler next;

    Handler setNext(Handler next) {
        this.next = next;
        return next;
    }

    void handle(UserRequest request) {
        if (!process(request) && next != null) {
            next.handle(request);
        }
    }

    protected abstract boolean process(UserRequest request);
}
```
- `setNext` 用流式写法便于链式拼接。
- `process` 返回 `true` 表示“已经处理完，不再往后传”。

### 步骤 3.3：实现具体处理者
```java
class AuthHandler extends Handler { /* 检查用户名/密码是否为空 */ }
class NetworkHandler extends Handler { /* 检查网络是否可用 */ }
class BusinessHandler extends Handler { /* 真正执行业务逻辑 */ }
```
- 每个类里只写自己的判断，不能处理时返回 `false`。

### 步骤 3.4：组装链条并发送请求
```java
Handler auth = new AuthHandler();
Handler network = new NetworkHandler();
Handler business = new BusinessHandler();

auth.setNext(network).setNext(business);

auth.handle(new UserRequest("Codex", "123456", true));
```
- 记住只需要让第一个节点 `handle`，其他节点会自动串联。

### 步骤 3.5：运行观察日志
- `AuthHandler`、`NetworkHandler`、`BusinessHandler` 都会打印各自的提示，便于理解流程。
- 修改请求字段就能看到链路在不同场景下的行为。

## 4. Android 中的常见应用场景
1. **View 事件分发**：`dispatchTouchEvent` / `onInterceptTouchEvent` / `onTouchEvent` 本质就是一条事件链，依次由 ViewGroup 和子 View 尝试消费触摸事件。
2. **OkHttp/Retrofit 拦截器**：网络请求发送前后会经过一系列 `Interceptor`，每个拦截器都能决定是否继续往后传递。
3. **Jetpack WorkManager/Coroutine 中的拦截器**：例如协程的 `ContinuationInterceptor`，也是管道式处理。
4. **系统权限/链式校验框架**：如多重表单校验、链式权限申请，一层层检查再决定是否继续。

## 5. 学完后可以做什么？
- 新增一个 Handler（如“冷却时间检查”）只需继承 `Handler` 并插入链条。
- 把该套路迁移到实际业务，比如：多重缓存读取（内存→磁盘→网络）、日志过滤、管道式拦截。
- 在 Android 工程里，把 Handler 写成 Java/Kotlin 类，通过依赖注入灵活拼装。

想继续练习？复制 `chain/ChainExample.java`，尝试添加新的节点（如“风控校验”），然后在 `main` 中调整链路顺序感受不同效果。
