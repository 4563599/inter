# Android çº¿ç¨‹æ± ä½¿ç”¨æŒ‡å—

## ğŸ“‹ å››ç§çº¿ç¨‹æ± ç±»å‹å¿«é€Ÿå‚è€ƒ

| çº¿ç¨‹æ± ç±»å‹ | æ ¸å¿ƒçº¿ç¨‹æ•° | æœ€å¤§çº¿ç¨‹æ•° | é˜Ÿåˆ—ç±»å‹ | é€‚ç”¨åœºæ™¯ | å…¸å‹åº”ç”¨ |
|-----------|-----------|-----------|---------|---------|---------|
| **FixedThreadPool** | n | n | LinkedBlockingQueue | CPUå¯†é›†å‹ä»»åŠ¡ | å¹¶è¡Œç½‘ç»œè¯·æ±‚ã€æ‰¹é‡å¤„ç† |
| **CachedThreadPool** | 0 | Integer.MAX_VALUE | SynchronousQueue | çŸ­æ—¶çªå‘ä»»åŠ¡ | å›¾ç‰‡è§£ç ã€ä¸´æ—¶è®¡ç®— |
| **SingleThreadExecutor** | 1 | 1 | LinkedBlockingQueue | é¡ºåºæ‰§è¡Œä»»åŠ¡ | æ–‡ä»¶å†™å…¥ã€æ—¥å¿—è®°å½• |
| **ScheduledThreadPool** | n | Integer.MAX_VALUE | DelayedWorkQueue | å®šæ—¶ä»»åŠ¡ | å®šæ—¶åˆ·æ–°ã€å¿ƒè·³æ£€æµ‹ |

## ğŸ”¥ æ ¸å¿ƒä½¿ç”¨åŸåˆ™

### âœ… æ¨èåšæ³•
```java
// 1. æ ¹æ®ä»»åŠ¡é€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ± 
ExecutorService fixedPool = Executors.newFixedThreadPool(2);    // å¹¶å‘æ§åˆ¶
ExecutorService cachedPool = Executors.newCachedThreadPool();   // çªå‘ä»»åŠ¡
ExecutorService singlePool = Executors.newSingleThreadExecutor(); // é¡ºåºæ‰§è¡Œ
ScheduledExecutorService scheduledPool = Executors.newScheduledThreadPool(1); // å®šæ—¶ä»»åŠ¡

// 2. æäº¤ä»»åŠ¡
fixedPool.execute(() -> {
    // ä½ çš„ä»»åŠ¡ä»£ç 
});

// 3. åŠæ—¶å…³é—­çº¿ç¨‹æ± 
fixedPool.shutdown(); // ä¼˜é›…å…³é—­ï¼Œç­‰å¾…ä»»åŠ¡å®Œæˆ
// æˆ–
fixedPool.shutdownNow(); // ç«‹å³å…³é—­ï¼Œä¸­æ–­ä»»åŠ¡
```

### âŒ é”™è¯¯åšæ³•
```java
// ä¸è¦ç›´æ¥åˆ›å»ºçº¿ç¨‹ - èµ„æºæµªè´¹
new Thread(() -> {
    // ä»»åŠ¡ä»£ç 
}).start();

// ä¸è¦å¿˜è®°å…³é—­çº¿ç¨‹æ±  - å†…å­˜æ³„éœ²
// æ²¡æœ‰è°ƒç”¨ shutdown()
```

## ğŸš€ æ€§èƒ½è°ƒä¼˜å»ºè®®

### CPUå¯†é›†å‹ä»»åŠ¡
- çº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° + 1
- ä½¿ç”¨ `FixedThreadPool`

### IOå¯†é›†å‹ä»»åŠ¡  
- çº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° Ã— 2
- å¯ä½¿ç”¨ `CachedThreadPool` æˆ– `FixedThreadPool`

### æ··åˆå‹ä»»åŠ¡
- æ ¹æ®å®é™…æµ‹è¯•è°ƒæ•´çº¿ç¨‹æ•°
- ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€

## ğŸ“± Android ç‰¹æ®Šæ³¨æ„äº‹é¡¹

### UIçº¿ç¨‹æ›´æ–°
```java
// ä»å·¥ä½œçº¿ç¨‹åˆ‡æ¢å›ä¸»çº¿ç¨‹æ›´æ–°UI
Handler mainHandler = new Handler(Looper.getMainLooper());
executorService.execute(() -> {
    // åå°ä»»åŠ¡
    String result = doBackgroundWork();
    
    // åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ›´æ–°UI
    mainHandler.post(() -> {
        textView.setText(result);
    });
});
```

### ç”Ÿå‘½å‘¨æœŸç®¡ç†
```java
public class MainActivity extends AppCompatActivity {
    private ExecutorService executor;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        executor = Executors.newFixedThreadPool(2);
    }
    
    @Override
    protected void onDestroy() {
        super.onDestroy();
        // é‡è¦ï¼šåŠæ—¶å…³é—­çº¿ç¨‹æ± 
        if (executor != null && !executor.isShutdown()) {
            executor.shutdownNow();
        }
    }
}
```

## ğŸ› ï¸ å®é™…åº”ç”¨ç¤ºä¾‹

### 1. ç½‘ç»œè¯·æ±‚ (FixedThreadPool)
```java
ExecutorService networkPool = Executors.newFixedThreadPool(3);

// å¹¶è¡Œå‘èµ·å¤šä¸ªç½‘ç»œè¯·æ±‚
for (String url : urls) {
    networkPool.execute(() -> {
        // æ‰§è¡Œç½‘ç»œè¯·æ±‚
        String response = httpRequest(url);
        // å¤„ç†ç»“æœ
    });
}
```

### 2. å›¾ç‰‡å¤„ç† (CachedThreadPool)
```java
ExecutorService imagePool = Executors.newCachedThreadPool();

// æ‰¹é‡å¤„ç†å›¾ç‰‡
for (String imagePath : imagePaths) {
    imagePool.execute(() -> {
        // è§£ç å’Œå‹ç¼©å›¾ç‰‡
        Bitmap bitmap = decodeImage(imagePath);
        saveThumbnail(bitmap);
    });
}
```

### 3. æ•°æ®åº“æ“ä½œ (SingleThreadExecutor)
```java
ExecutorService dbPool = Executors.newSingleThreadExecutor();

// ä¿è¯æ•°æ®åº“æ“ä½œé¡ºåºæ‰§è¡Œ
dbPool.execute(() -> database.insert(data1));
dbPool.execute(() -> database.update(data2));
dbPool.execute(() -> database.delete(data3));
```

### 4. å®šæ—¶ä»»åŠ¡ (ScheduledThreadPool)
```java
ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);

// å»¶æ—¶æ‰§è¡Œ
scheduler.schedule(() -> {
    // 5ç§’åæ‰§è¡Œ
}, 5, TimeUnit.SECONDS);

// å‘¨æœŸæ€§æ‰§è¡Œ
scheduler.scheduleAtFixedRate(() -> {
    // æ¯30ç§’æ‰§è¡Œä¸€æ¬¡
}, 0, 30, TimeUnit.SECONDS);
```

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€
```java
ThreadPoolExecutor pool = (ThreadPoolExecutor) Executors.newFixedThreadPool(2);

// è·å–çº¿ç¨‹æ± ä¿¡æ¯
int activeCount = pool.getActiveCount();      // æ´»è·ƒçº¿ç¨‹æ•°
long taskCount = pool.getTaskCount();         // æ€»ä»»åŠ¡æ•°
long completedCount = pool.getCompletedTaskCount(); // å®Œæˆä»»åŠ¡æ•°
int queueSize = pool.getQueue().size();       // é˜Ÿåˆ—å¤§å°

Log.d("ThreadPool", "æ´»è·ƒçº¿ç¨‹: " + activeCount + 
      ", é˜Ÿåˆ—å¤§å°: " + queueSize + 
      ", å®Œæˆä»»åŠ¡: " + completedCount);
```

## âš ï¸ å¸¸è§é™·é˜±

1. **å¿˜è®°å…³é—­çº¿ç¨‹æ± ** â†’ å†…å­˜æ³„éœ²
2. **çº¿ç¨‹æ•°è®¾ç½®è¿‡å¤§** â†’ ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€
3. **é˜»å¡ä¸»çº¿ç¨‹** â†’ ANR (åº”ç”¨æ— å“åº”)
4. **ä»»åŠ¡é—´æœ‰ä¾èµ–** â†’ ä½¿ç”¨é”™è¯¯çš„çº¿ç¨‹æ± ç±»å‹
5. **å¼‚å¸¸å¤„ç†ä¸å½“** â†’ çº¿ç¨‹æ„å¤–ç»ˆæ­¢

## ğŸ“š æ€»ç»“

é€‰æ‹©çº¿ç¨‹æ± çš„å†³ç­–æµç¨‹ï¼š
1. **éœ€è¦é¡ºåºæ‰§è¡Œï¼Ÿ** â†’ SingleThreadExecutor
2. **éœ€è¦å®šæ—¶æ‰§è¡Œï¼Ÿ** â†’ ScheduledThreadPool  
3. **ä»»åŠ¡é‡å¯é¢„æµ‹ï¼Ÿ** â†’ FixedThreadPool
4. **çªå‘çŸ­ä»»åŠ¡ï¼Ÿ** â†’ CachedThreadPool

è®°ä½ï¼š**åˆé€‚çš„çº¿ç¨‹æ±  + æ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç† = é«˜æ€§èƒ½Androidåº”ç”¨**
