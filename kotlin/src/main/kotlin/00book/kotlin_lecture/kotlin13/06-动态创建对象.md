# Kotlin åå°„ - åŠ¨æ€åˆ›å»ºå¯¹è±¡

## ğŸ“– åŠ¨æ€åˆ›å»ºå¯¹è±¡æ¦‚è¿°

é€šè¿‡åå°„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œæ— éœ€åœ¨ç¼–è¯‘æ—¶çŸ¥é“å…·ä½“çš„ç±»å‹ã€‚è¿™åœ¨æ¡†æ¶å¼€å‘ã€æ’ä»¶ç³»ç»Ÿç­‰åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚

---

## 1. ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin21.kt

```kotlin
class MyTestClass9(value: Int = 0) {
    fun printSomething() {
        println("Something")
    }

    fun printNothing() {
        println("Nothing")
    }
}

fun main(args: Array<String>) {
    var myTestClass9 = MyTestClass9::class
    var myObj = myTestClass9.createInstance()  // ä½¿ç”¨é»˜è®¤å‚æ•°åˆ›å»ºå®ä¾‹

    // åŠ¨æ€è°ƒç”¨æ–¹æ³•
    myTestClass9.functions.find { it.name == "printSomething" }?.call(myObj)
    // è¾“å‡ºï¼šSomething
    
    myTestClass9.functions.find { it.name == "printNothing" }?.call(myObj)
    // è¾“å‡ºï¼šNothing
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- `createInstance()` è°ƒç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡
- å¦‚æœæ„é€ å‡½æ•°æœ‰é»˜è®¤å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ `createInstance()`
- åˆ›å»ºå¯¹è±¡åå¯ä»¥åŠ¨æ€è°ƒç”¨å…¶æ–¹æ³•

**æ³¨æ„äº‹é¡¹ï¼š**
- `createInstance()` åªèƒ½ç”¨äºæœ‰æ— å‚æ„é€ å‡½æ•°çš„ç±»
- å¦‚æœæ„é€ å‡½æ•°å‚æ•°æ²¡æœ‰é»˜è®¤å€¼ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸
- éœ€è¦å¯¼å…¥ `kotlin.reflect.full.createInstance`

---

## 2. ä½¿ç”¨ç‰¹å®šæ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin22.kt

```kotlin
class MyTestClass10(var name: String) {
    var price = 0.0

    constructor(): this("æœªçŸ¥å•†å“") {
        this.price = 0.0
    }

    constructor(name: String, price: Double) : this(name) {
        this.price = price
    }
}

fun main(args: Array<String>) {
    val clazz = MyTestClass10::class
    
    // ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°
    val instance = clazz.createInstance()
    println(instance.name)   // è¾“å‡ºï¼šæœªçŸ¥å•†å“
    println(instance.price)  // è¾“å‡ºï¼š0.0

    // è·å–æ‰€æœ‰æ„é€ å‡½æ•°
    val cons = clazz.constructors

    // éå†æ„é€ å‡½æ•°ï¼Œæ‰¾åˆ°å‚æ•°ä¸ªæ•°ä¸º2çš„æ„é€ å‡½æ•°
    cons.forEach {
        if (it.parameters.size == 2) {
            val instance2 = it.call("python", 34.5)
            println(instance2.name)   // è¾“å‡ºï¼špython
            println(instance2.price)  // è¾“å‡ºï¼š34.5
        }
    }
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- `constructors` è·å–æ‰€æœ‰æ„é€ å‡½æ•°
- é€šè¿‡ `parameters.size` åˆ¤æ–­æ„é€ å‡½æ•°çš„å‚æ•°ä¸ªæ•°
- ä½¿ç”¨ `call()` è°ƒç”¨ç‰¹å®šæ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡
- å¯ä»¥ä¼ å…¥ä¸åŒçš„å‚æ•°åˆ›å»ºä¸åŒçŠ¶æ€çš„å¯¹è±¡

**æ‰“å°æç¤ºï¼š**
- æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ä½¿ç”¨é»˜è®¤å€¼
- å¸¦å‚æ„é€ å‡½æ•°å¯ä»¥æŒ‡å®šåˆå§‹å€¼
- ä¸åŒæ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡çŠ¶æ€ä¸åŒ

---

## 3. å®Œæ•´çš„å¯¹è±¡åˆ›å»ºå’Œæ–¹æ³•è°ƒç”¨æµç¨‹

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin23.ktï¼ˆå·²åœ¨ä¸Šä¸€ç« èŠ‚å±•ç¤ºï¼‰

```kotlin
class MyTestClass11 {
    fun method(message: String) {
        println("æ‰§è¡Œå¸¦Stringå‚æ•°çš„æ–¹æ³•ï¼š $message")
    }

    fun method(message: String, price: Double) {
        println("æ‰§è¡Œå¸¦String, Doubleå‚æ•°çš„æ–¹æ³•: $message $price")
    }
}

fun main(args: Array<String>) {
    val clazz = MyTestClass11::class
    val instance = clazz.createInstance()  // åˆ›å»ºå¯¹è±¡

    val funs = clazz.declaredFunctions

    for (f in funs) {
        if (f.parameters.size == 3) {
            f.call(instance, "Ruby", 23.4)
            // è¾“å‡ºï¼šæ‰§è¡Œå¸¦String, Doubleå‚æ•°çš„æ–¹æ³•: Ruby 23.4
        }

        if (f.parameters.size == 2) {
            f.call(instance, "Flutter")
            // è¾“å‡ºï¼šæ‰§è¡Œå¸¦Stringå‚æ•°çš„æ–¹æ³•ï¼š Flutter
        }
    }
}
```

**å®Œæ•´æµç¨‹ï¼š**
1. è·å–ç±»çš„ KClass å¯¹è±¡
2. ä½¿ç”¨ `createInstance()` åˆ›å»ºå¯¹è±¡å®ä¾‹
3. è·å–ç±»çš„æ–¹æ³•åˆ—è¡¨
4. åŠ¨æ€è°ƒç”¨æ–¹æ³•

**åº”ç”¨åœºæ™¯ï¼š**
- ä¾èµ–æ³¨å…¥æ¡†æ¶
- å¯¹è±¡æ± 
- å·¥å‚æ¨¡å¼çš„åŠ¨æ€å®ç°

---

## 4. åˆ›å»ºå¯¹è±¡å¹¶æ“ä½œå±æ€§

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin24.ktï¼ˆå·²åœ¨ä¸Šä¸€ç« èŠ‚å±•ç¤ºï¼‰

```kotlin
class MyTestClass12 {
    var name: String = "Flutter"
    val price: Double = 34.5
}

fun main(args: Array<String>) {
    val clazz = MyTestClass12::class
    val instance = clazz.createInstance()  // åˆ›å»ºå¯¹è±¡
    var props = clazz.declaredMemberProperties

    props.forEach {
        when (it.name) {
            "name" -> {
                val kmp = it as KMutableProperty1<MyTestClass12, Any>
                kmp.set(instance, "Hadoop")  // ä¿®æ”¹å±æ€§
                println(it.get(instance))
                // è¾“å‡ºï¼šHadoop
            }
            "price" -> {
                println(it.get(instance))
                // è¾“å‡ºï¼š34.5
            }
        }
    }
}
```

**å®Œæ•´æµç¨‹ï¼š**
1. è·å–ç±»çš„ KClass å¯¹è±¡
2. åˆ›å»ºå¯¹è±¡å®ä¾‹
3. è·å–å±æ€§åˆ—è¡¨
4. åŠ¨æ€è®¿é—®å’Œä¿®æ”¹å±æ€§

---

## 5. å®é™…åº”ç”¨ç¤ºä¾‹ï¼šé€šç”¨å¯¹è±¡å·¥å‚

```kotlin
// é€šç”¨å¯¹è±¡å·¥å‚
class ObjectFactory {
    companion object {
        // æ ¹æ®ç±»ååˆ›å»ºå¯¹è±¡
        inline fun <reified T : Any> create(): T {
            return T::class.createInstance()
        }
        
        // æ ¹æ®ç±»åå’Œå‚æ•°åˆ›å»ºå¯¹è±¡
        fun <T : Any> create(clazz: KClass<T>, vararg args: Any?): T {
            // æŸ¥æ‰¾åŒ¹é…çš„æ„é€ å‡½æ•°
            val constructor = clazz.constructors.find { 
                it.parameters.size == args.size 
            }
            
            return constructor?.call(*args) 
                ?: throw IllegalArgumentException("æ‰¾ä¸åˆ°åŒ¹é…çš„æ„é€ å‡½æ•°")
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
fun main() {
    // ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°
    val obj1 = ObjectFactory.create<MyTestClass9>()
    
    // ä½¿ç”¨å¸¦å‚æ„é€ å‡½æ•°
    val obj2 = ObjectFactory.create(MyTestClass10::class, "å•†å“å", 99.9)
    println(obj2.name)   // è¾“å‡ºï¼šå•†å“å
    println(obj2.price)  // è¾“å‡ºï¼š99.9
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- ä½¿ç”¨æ³›å‹å’Œ `reified` å…³é”®å­—å®ç°ç±»å‹å®‰å…¨çš„å¯¹è±¡åˆ›å»º
- é€šè¿‡å‚æ•°ä¸ªæ•°åŒ¹é…æ„é€ å‡½æ•°
- ä½¿ç”¨ `vararg` æ”¯æŒå¯å˜å‚æ•°
- å°è£…åå°„ç»†èŠ‚ï¼Œæä¾›ç®€æ´çš„ API

---

## ğŸ’¡ æ€»ç»“

**å¯¹è±¡åˆ›å»ºçš„æ–¹å¼ï¼š**

| æ–¹å¼ | API | é€‚ç”¨åœºæ™¯ |
|------|-----|---------|
| æ— å‚æ„é€  | `KClass.createInstance()` | æœ‰æ— å‚æ„é€ å‡½æ•°æˆ–æ‰€æœ‰å‚æ•°æœ‰é»˜è®¤å€¼ |
| ç‰¹å®šæ„é€  | `KFunction.call(args...)` | éœ€è¦ä¼ å…¥ç‰¹å®šå‚æ•° |
| æŸ¥æ‰¾æ„é€  | `constructors.find { ... }` | æ ¹æ®æ¡ä»¶æŸ¥æ‰¾åˆé€‚çš„æ„é€ å‡½æ•° |

**æ³¨æ„äº‹é¡¹ï¼š**
1. `createInstance()` éœ€è¦å¯¼å…¥ `kotlin.reflect.full.createInstance`
2. å¦‚æœæ²¡æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œ`createInstance()` ä¼šæŠ›å‡ºå¼‚å¸¸
3. æ„é€ å‡½æ•°çš„ `call()` å‚æ•°å¿…é¡»ä¸æ„é€ å‡½æ•°ç­¾ååŒ¹é…
4. å¯ä»¥é€šè¿‡ `parameters` å±æ€§æ£€æŸ¥æ„é€ å‡½æ•°çš„å‚æ•°ä¿¡æ¯

**åº”ç”¨åœºæ™¯ï¼š**
- ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¡†æ¶
- å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰
- åºåˆ—åŒ–/ååºåˆ—åŒ–
- æ’ä»¶ç³»ç»Ÿ
- å·¥å‚æ¨¡å¼
- å•å…ƒæµ‹è¯•æ¡†æ¶

**æœ€ä½³å®è·µï¼š**
1. ä¼˜å…ˆä½¿ç”¨ `createInstance()` åˆ›å»ºç®€å•å¯¹è±¡
2. å¯¹äºå¤æ‚å¯¹è±¡ï¼Œä½¿ç”¨ç‰¹å®šæ„é€ å‡½æ•°
3. å°è£…åå°„é€»è¾‘ï¼Œæä¾›ç±»å‹å®‰å…¨çš„ API
4. å¤„ç†å¯èƒ½çš„å¼‚å¸¸ï¼ˆå¦‚æ‰¾ä¸åˆ°æ„é€ å‡½æ•°ï¼‰
5. è€ƒè™‘æ€§èƒ½å½±å“ï¼Œé¿å…é¢‘ç¹ä½¿ç”¨åå°„
