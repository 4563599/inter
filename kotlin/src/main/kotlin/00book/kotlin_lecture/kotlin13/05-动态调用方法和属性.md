# Kotlin åå°„ - åŠ¨æ€è°ƒç”¨æ–¹æ³•å’Œå±æ€§

## ğŸ“– åŠ¨æ€è°ƒç”¨æ¦‚è¿°

åå°„æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å±æ€§ï¼Œæ— éœ€åœ¨ç¼–è¯‘æ—¶çŸ¥é“å…·ä½“çš„æ–¹æ³•åæˆ–å±æ€§åã€‚

---

## 1. åŠ¨æ€è°ƒç”¨æ–¹æ³•

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin17.kt

```kotlin
class MyTestClass5 {
    fun printSomething(name: String) {
        println("something: $name")
    }

    fun printNothing() {
        println("nothing")
    }
}

fun main(args: Array<String>) {
    val myTestClass5 = MyTestClass5::class
    val testClass5 = MyTestClass5()

    // æŸ¥æ‰¾å¹¶è°ƒç”¨æ— å‚æ–¹æ³•
    var functionToInvoke = myTestClass5.functions.find { it.name == "printNothing" }
    functionToInvoke?.call(testClass5)
    // è¾“å‡ºï¼šnothing

    // æŸ¥æ‰¾å¹¶è°ƒç”¨å¸¦å‚æ–¹æ³•
    var funToInvoke = myTestClass5.functions.find { it.name == "printSomething" }
    funToInvoke?.call(testClass5, "hello world")
    // è¾“å‡ºï¼šsomething: hello world
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- ä½¿ç”¨ `functions` è·å–æ‰€æœ‰æ–¹æ³•
- ä½¿ç”¨ `find` æ ¹æ®æ–¹æ³•åæŸ¥æ‰¾ç‰¹å®šæ–¹æ³•
- ä½¿ç”¨ `call()` åŠ¨æ€è°ƒç”¨æ–¹æ³•
- `call()` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡å®ä¾‹ï¼Œåç»­å‚æ•°æ˜¯æ–¹æ³•å‚æ•°

**æ‰“å°æç¤ºï¼š**
- æ— å‚æ–¹æ³•ï¼š`call(å¯¹è±¡å®ä¾‹)`
- æœ‰å‚æ–¹æ³•ï¼š`call(å¯¹è±¡å®ä¾‹, å‚æ•°1, å‚æ•°2, ...)`
- å¦‚æœæ–¹æ³•ä¸å­˜åœ¨ï¼Œ`find` è¿”å› nullï¼Œä½¿ç”¨ `?.` å®‰å…¨è°ƒç”¨

---

## 2. åŠ¨æ€è®¿é—®å±æ€§

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin18.kt

```kotlin
class MyTestClass6 {
    var name: String = "hello world"
}

fun main(args: Array<String>) {
    val myTestClass6 = MyTestClass6::class
    var testClass6 = MyTestClass6()

    // æŸ¥æ‰¾å±æ€§
    var variableToInvoke = myTestClass6.memberProperties.find { it.name == "name" }

    // ä¸¤ç§æ–¹å¼è·å–å±æ€§å€¼
    println(variableToInvoke?.get(testClass6))
    // è¾“å‡ºï¼šhello world
    
    println(variableToInvoke?.call(testClass6))
    // è¾“å‡ºï¼šhello world
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- ä½¿ç”¨ `memberProperties` è·å–æ‰€æœ‰å±æ€§
- ä½¿ç”¨ `find` æ ¹æ®å±æ€§åæŸ¥æ‰¾ç‰¹å®šå±æ€§
- ä½¿ç”¨ `get()` æˆ– `call()` è·å–å±æ€§å€¼
- ä¸¤ç§æ–¹å¼æ•ˆæœç›¸åŒï¼Œ`get()` æ›´è¯­ä¹‰åŒ–

**æ‰“å°æç¤ºï¼š**
- `get(å¯¹è±¡å®ä¾‹)` è·å–å±æ€§å€¼
- `call(å¯¹è±¡å®ä¾‹)` ä¹Ÿå¯ä»¥è·å–å±æ€§å€¼ï¼ˆå› ä¸ºå±æ€§æœ¬è´¨ä¸Šæ˜¯æ–¹æ³•ï¼‰

---

## 3. åŠ¨æ€ä¿®æ”¹å±æ€§

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin19.kt

```kotlin
class MyTestClass7 {
    var name: String = "hello world"
    var authorName: String = "tom"
}

fun main(args: Array<String>) {
    val myTestClass7 = MyTestClass7::class
    var testClass7 = MyTestClass7()

    // æŸ¥æ‰¾å±æ€§
    var variableToInvoke = myTestClass7.memberProperties.find { it.name == "name" }
    println(variableToInvoke?.get(testClass7))
    // è¾“å‡ºï¼šhello world

    // æ£€æŸ¥æ˜¯å¦ä¸ºå¯å˜å±æ€§ï¼Œç„¶åä¿®æ”¹
    if (variableToInvoke is KMutableProperty<*>) {
        variableToInvoke.setter.call(testClass7, "welcome")
    }

    println(variableToInvoke?.get(testClass7))
    // è¾“å‡ºï¼šwelcome
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- ä½¿ç”¨ `is KMutableProperty<*>` æ£€æŸ¥å±æ€§æ˜¯å¦å¯å˜
- åªæœ‰ var å±æ€§æ‰æ˜¯ `KMutableProperty`
- ä½¿ç”¨ `setter.call()` ä¿®æ”¹å±æ€§å€¼
- val å±æ€§æ— æ³•ä¿®æ”¹

**æ‰“å°æç¤ºï¼š**
- ä¿®æ”¹å‰ï¼šhello world
- ä¿®æ”¹åï¼šwelcome
- ç±»å‹æ£€æŸ¥ç¡®ä¿åªä¿®æ”¹å¯å˜å±æ€§

---

## 4. åŠ¨æ€è°ƒç”¨é‡è½½æ–¹æ³•

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin23.kt

```kotlin
class MyTestClass11 {
    fun method(message: String) {
        println("æ‰§è¡Œå¸¦Stringå‚æ•°çš„æ–¹æ³•ï¼š $message")
    }

    fun method(message: String, price: Double) {
        println("æ‰§è¡Œå¸¦String, Doubleå‚æ•°çš„æ–¹æ³•: $message $price")
    }
}

fun main(args: Array<String>) {
    val clazz = MyTestClass11::class
    val instance = clazz.createInstance()

    val funs = clazz.declaredFunctions

    for (f in funs) {
        // æ ¹æ®å‚æ•°ä¸ªæ•°è°ƒç”¨ä¸åŒçš„é‡è½½æ–¹æ³•
        if (f.parameters.size == 3) {  // åŒ…å« this å‚æ•°
            f.call(instance, "Ruby", 23.4)
            // è¾“å‡ºï¼šæ‰§è¡Œå¸¦String, Doubleå‚æ•°çš„æ–¹æ³•: Ruby 23.4
        }

        if (f.parameters.size == 2) {  // åŒ…å« this å‚æ•°
            f.call(instance, "Flutter")
            // è¾“å‡ºï¼šæ‰§è¡Œå¸¦Stringå‚æ•°çš„æ–¹æ³•ï¼š Flutter
        }
    }
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- `declaredFunctions` è·å–ç±»å£°æ˜çš„æ–¹æ³•ï¼ˆä¸åŒ…æ‹¬ç»§æ‰¿çš„ï¼‰
- `parameters.size` è·å–å‚æ•°ä¸ªæ•°
- æˆå‘˜æ–¹æ³•çš„å‚æ•°ä¸ªæ•°åŒ…æ‹¬éšå¼çš„ `this` å‚æ•°
- å¯ä»¥æ ¹æ®å‚æ•°ä¸ªæ•°åŒºåˆ†é‡è½½æ–¹æ³•

**å‚æ•°ä¸ªæ•°è¯´æ˜ï¼š**
- `method(String)` çš„ `parameters.size` æ˜¯ 2ï¼ˆthis + Stringï¼‰
- `method(String, Double)` çš„ `parameters.size` æ˜¯ 3ï¼ˆthis + String + Doubleï¼‰

---

## 5. åŠ¨æ€ä¿®æ”¹å±æ€§ï¼ˆç±»å‹å®‰å…¨ï¼‰

### ç¤ºä¾‹ä»£ç ï¼šHelloKotlin24.kt

```kotlin
class MyTestClass12 {
    var name: String = "Flutter"
    val price: Double = 34.5
}

fun main(args: Array<String>) {
    val clazz = MyTestClass12::class
    val instance = clazz.createInstance()
    var props = clazz.declaredMemberProperties

    props.forEach {
        when (it.name) {
            "name" -> {
                // ç±»å‹å®‰å…¨çš„å±æ€§ä¿®æ”¹
                val kmp = it as KMutableProperty1<MyTestClass12, Any>
                kmp.set(instance, "Hadoop")
                println(it.get(instance))
                // è¾“å‡ºï¼šHadoop
            }
            "price" -> {
                println(it.get(instance))
                // è¾“å‡ºï¼š34.5
            }
        }
    }
}
```

**çŸ¥è¯†ç‚¹ï¼š**
- `declaredMemberProperties` è·å–ç±»å£°æ˜çš„å±æ€§ï¼ˆä¸åŒ…æ‹¬ç»§æ‰¿çš„ï¼‰
- `KMutableProperty1<T, R>` æ˜¯ç±»å‹å®‰å…¨çš„å¯å˜å±æ€§å¼•ç”¨
- ç¬¬ä¸€ä¸ªç±»å‹å‚æ•°æ˜¯æ¥æ”¶è€…ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯å±æ€§ç±»å‹
- ä½¿ç”¨ `set()` æ–¹æ³•ä¿®æ”¹å±æ€§å€¼

**ç±»å‹è¯´æ˜ï¼š**
- `KMutableProperty1` ä¸­çš„ `1` è¡¨ç¤ºéœ€è¦ 1 ä¸ªæ¥æ”¶è€…å‚æ•°
- `KMutableProperty0` è¡¨ç¤ºé¡¶å±‚å±æ€§ï¼ˆä¸éœ€è¦æ¥æ”¶è€…ï¼‰
- `KMutableProperty2` è¡¨ç¤ºæ‰©å±•å±æ€§ï¼ˆéœ€è¦ 2 ä¸ªå‚æ•°ï¼‰

---

## ğŸ’¡ æ€»ç»“

**åŠ¨æ€è°ƒç”¨çš„æ ¸å¿ƒ APIï¼š**

| æ“ä½œ | API | è¯´æ˜ |
|------|-----|------|
| è°ƒç”¨æ–¹æ³• | `function.call(instance, args...)` | ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡å®ä¾‹ |
| è·å–å±æ€§ | `property.get(instance)` | è·å–å±æ€§å€¼ |
| ä¿®æ”¹å±æ€§ | `mutableProperty.setter.call(instance, value)` | ä¿®æ”¹å¯å˜å±æ€§ |
| ç±»å‹å®‰å…¨ä¿®æ”¹ | `KMutableProperty1.set(instance, value)` | ç±»å‹å®‰å…¨çš„ä¿®æ”¹ |

**æ³¨æ„äº‹é¡¹ï¼š**
1. æˆå‘˜æ–¹æ³•çš„ `call()` ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯¹è±¡å®ä¾‹
2. æˆå‘˜æ–¹æ³•çš„å‚æ•°ä¸ªæ•°åŒ…æ‹¬éšå¼çš„ `this` å‚æ•°
3. åªæœ‰ `KMutableProperty` æ‰èƒ½ä¿®æ”¹
4. ä½¿ç”¨ `declaredXxx` åªè·å–å½“å‰ç±»å£°æ˜çš„æˆå‘˜ï¼Œä¸åŒ…æ‹¬ç»§æ‰¿çš„

**åº”ç”¨åœºæ™¯ï¼š**
- æ’ä»¶ç³»ç»Ÿ
- é…ç½®é©±åŠ¨çš„è¡Œä¸º
- åŠ¨æ€ä»£ç†
- ORM æ¡†æ¶
- åºåˆ—åŒ–/ååºåˆ—åŒ–
